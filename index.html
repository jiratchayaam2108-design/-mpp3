<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏´‡∏ï‡∏∏ micro:bit</title>

<style>
body {
  font-family: sans-serif;
  text-align: center;
  margin-top: 50px;
}
button {
  font-size: 18px;
  padding: 12px 25px;
}
#log {
  margin-top: 30px;
  font-size: 22px;
  font-weight: bold;
}
.emergency { color: red; }
.help { color: orange; }
.ok { color: green; }
</style>
</head>

<body>

<h1>üö® ‡∏£‡∏∞‡∏ö‡∏ö‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÅ‡∏•‡∏∞‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏´‡∏ï‡∏∏‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô</h1>
<button onclick="connect()">üîµ ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ micro:bit</button>

<div id="log">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠</div>

<script>
const UART_SERVICE = "6e400001-b5a3-f393-e0a9-e50e24dcca9e";
const UART_TX = "6e400003-b5a3-f393-e0a9-e50e24dcca9e"; // ‡∏£‡∏±‡∏ö‡∏à‡∏≤‡∏Å micro:bit

async function connect() {
  try {
    const device = await navigator.bluetooth.requestDevice({
      filters: [{ namePrefix: "BBC micro:bit" }],
      optionalServices: [UART_SERVICE]
    });

    const server = await device.gatt.connect();
    const service = await server.getPrimaryService(UART_SERVICE);
    const tx = await service.getCharacteristic(UART_TX);

    await tx.startNotifications();
    tx.addEventListener("characteristicvaluechanged", onData);

    document.getElementById("log").textContent =
      "‚úÖ ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÅ‡∏•‡πâ‡∏ß: " + device.name;

  } catch (err) {
    document.getElementById("log").textContent =
      "‚ùå Error: " + err.message;
  }
}

function onData(event) {
  const text = new TextDecoder().decode(event.target.value).trim();
  const log = document.getElementById("log");

  if (text === "EMERGENCY") {
    log.textContent = "üö® ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏´‡∏ï‡∏∏‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô!";
    log.className = "emergency";
  } 
  else if (text === "HELP") {
    log.textContent = "üÜò ‡∏Ç‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠";
    log.className = "help";
  } 
  else if (text === "OK") {
    log.textContent = "‚úÖ ‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡πÅ‡∏•‡πâ‡∏ß";
    log.className = "ok";
  } 
  else {
    log.textContent = "üì© " + text;
    log.className = "";
  }
}
</script>

</body>
</html>

