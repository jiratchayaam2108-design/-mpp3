<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>MPP3 Emergency System</title>

  <style>
    body{
      margin:0;
      font-family: "Segoe UI", Arial, sans-serif;
      background: linear-gradient(135deg,#fff7cc,#e3f2fd);
      height:100vh;
      display:flex;
      justify-content:center;
      align-items:center;
    }

    .card{
      background:#ffffff;
      width:420px;
      padding:35px;
      border-radius:25px;
      text-align:center;
      box-shadow:0 15px 40px rgba(0,0,0,0.15);
    }

    .logo{
      font-size:42px;
      font-weight:bold;
      color:#f4b400;
      margin-bottom:5px;
    }

    .school{
      font-size:15px;
      color:#2979ff;
      margin-bottom:25px;
    }

    button{
      background: linear-gradient(90deg,#fdd835,#42a5f5);
      border:none;
      color:#fff;
      padding:14px 28px;
      font-size:16px;
      border-radius:30px;
      cursor:pointer;
      margin:8px;
      box-shadow:0 6px 15px rgba(0,0,0,0.15);
    }

    button:hover{
      opacity:0.9;
    }

    input{
      width:80%;
      padding:12px;
      border-radius:20px;
      border:1px solid #ccc;
      font-size:15px;
      text-align:center;
      margin-top:10px;
    }

    #status{
      margin-top:18px;
      font-weight:bold;
      color:#444;
    }

    .footer{
      margin-top:25px;
      font-size:13px;
      color:#777;
    }
  </style>
</head>

<body>

  <div class="card">
    <div class="logo">MPP3</div>
    <div class="school">
      ‡∏£‡∏∞‡∏ö‡∏ö‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÅ‡∏•‡∏∞‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏´‡∏ï‡∏∏‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô<br>
      ‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏°‡∏±‡∏ò‡∏¢‡∏°‡∏û‡∏±‡∏ä‡∏£‡∏Å‡∏¥‡∏ï‡∏¥‡∏¢‡∏≤‡∏†‡∏≤ ‡πì ‡∏™‡∏∏‡∏£‡∏≤‡∏©‡∏é‡∏£‡πå‡∏ò‡∏≤‡∏ô‡∏µ
    </div>

    <button onclick="connect()">üîµ ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ micro:bit</button>

    <br>

    <input id="msg" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏´‡∏ï‡∏∏" />
    <br>
    <button onclick="send()">üì® ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>

    <div id="status">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠</div>

    <div class="footer">
      Bluetooth UART ‡∏ú‡πà‡∏≤‡∏ô Web Bluetooth
    </div>
  </div>

<script>
let txChar;

async function connect() {
  try {
    const device = await navigator.bluetooth.requestDevice({
      filters: [{ namePrefix: 'BBC micro:bit' }],
      optionalServices: ['6e400001-b5a3-f393-e0a9-e50e24dcca9e']
    });

    const server = await device.gatt.connect();
    const service = await server.getPrimaryService(
      '6e400001-b5a3-f393-e0a9-e50e24dcca9e'
    );

    txChar = await service.getCharacteristic(
      '6e400002-b5a3-f393-e0a9-e50e24dcca9e'
    );

    document.getElementById("status").innerText =
      "‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‚úÖ ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ micro:bit ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à";
  } catch (err) {
    document.getElementById("status").innerText =
      "‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏î‡πâ";
    console.error(err);
  }
}

async function send() {
  if (!txChar) {
    alert("‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ micro:bit");
    return;
  }
  const text = document.getElementById("msg").value + "\n";
  const data = new TextEncoder().encode(text);
  await txChar.writeValue(data);
}
</script>

</body>
</html>
